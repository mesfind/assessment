## Analysis of the Carpentries Instructor Training Post-Workshop Survey Data
__Lead:__ [Kari L. Jordan](https://github.com/kariljordan)

```{r setup, include=FALSE}
library(knitr)
library(tidyverse)
library(likert)
opts_chunk$set(echo = FALSE,
               message = FALSE,
               warning = FALSE)
opts_chunk$set(fig.path='figures/2018_') #puts all figures in figures folder
```


```{r include=FALSE}
# Load dataset
postdata <- readr::read_csv("https://raw.githubusercontent.com/carpentries/assessment/master/programmatic-assessment/instructor-training/analyses/post-workshop/2018/2018-03-01_data.csv")

```

```{r}
# Function that makes a table of counts and percentages
# question_n is set by default to the number of respondents in the survey. This value may have to be set by question.
question_n <- nrow(postdata)

tally_and_perc <- function(df, colname, na.rm = FALSE, question_n){
  quo_colname <- enquo(colname)

  df %>%
    group_by(!!quo_colname) %>%
    tally() %>%
    filter(if_else(rep(na.rm, nrow(.)),
                  !is.na(!!quo_colname),
                  as.logical(rep(1, nrow(.))))) %>%
    mutate(`%` = round(n / question_n * 100, 1))
}

# function to compute number of non-NA responses to a question

n_responses_to_the_question <- function(df, from_colname, to_colname) {

  quo_from_colname <- enquo(from_colname)
  quo_to_colname <- enquo(to_colname)

  rowsums <-
df %>%
  select(UQ(quo_from_colname):UQ(quo_to_colname)) %>%
  # check that each row has a value for at least one col
  # convert to numeric, if NA, then put a zero, otherwise 1
  map_df(., ~ifelse(is.na(.x), 0, 1)) %>%
  # sum to see if any rows have no reponses
  rowSums()

# for all behaviors
idx <- ifelse(rowsums == 0, FALSE, TRUE)
sum(idx)
}
```

This analysis of The Carpentries Instructor Training [post-workshop survey](https://github.com/carpentries/assessment/blob/master/programmatic-assessment/instructor-training/surveys/current_survey.pdf) serves to offer recommendations for changes to curriculum and assessment of our instructor training program.

There were a total 573 trainees who completed this survey in between 2016 and 2018.

## When are respondents completing the post-workshop survey?

When are you taking this survey?

```{r}
# When are you taking this survey?
when_taking = c("I have just completed the training, and am taking it at the event", "I have recently completed the training, and am taking it after I left the event")
when_taking = factor(when_taking)

postdata$WhenTaking = factor(postdata$WhenTaking, levels = when_taking)

postdata_when_taking_tally <-
  postdata %>%
  group_by(WhenTaking) %>%
  tally() %>%
  filter(!is.na(WhenTaking)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_when_taking_tally)
# Come back and fix table column headers
```
### Demographics

__Respondents Position__

What is your current position?

```{r trainees_position}
# What is your current position?
position = c("Undergraduate Student", "Graduate Student", "Post-doctoral researcher", "Faculty", "Research staff (including research programmer", "Support staff (including technical support)", "Librarian/archivist", "Commercial software developer", "Other (please specify)")
position = factor(position)

postdata$Position = factor(postdata$Position, levels = position)

postdata_position_tally <-
  postdata %>%
  group_by(Position) %>%
  tally() %>%
  filter(!is.na(Position)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

ggplot(postdata_position_tally,
       aes(Position, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="orange") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Respondents' Position") +
  ylab("% Respondents") +
  ggtitle("Breakdown of Instructor Trainees by Position") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
```

In the interest of improving diversity, we collect additional demographic information for U.S. participants. This information is completely voluntary.

__How would you describe yourself?__

```{r}
# How would you describe yourself?
race = c("American Indian or Alaska Native",
"Asian",
"Black or African American",
"Hispanic or Latino(a)",
"Native Hawaiian or Other Pacific Islander",
"White",
"Prefer not to say",
"Multiple ethnicity / Other (please specify)")
race = factor(race)

postdata$Race = factor(postdata$Race, levels = race)

postdata_race_tally <-
  postdata %>%
  group_by(Race) %>%
  tally() %>%
  filter(!is.na(Race)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_race_tally)
```

__What is your gender?__

```{r}
# What is your gender?
gender = c("Female", "Male", "Other", "Prefer not to say")
gender = factor(gender)

postdata$Gender = factor(postdata$Gender, levels = gender)

postdata_gender_tally <-
  postdata %>%
  group_by(Gender) %>%
  tally() %>%
  filter(!is.na(Gender)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_gender_tally)
```

__Domain of research/study__

What is your downain of research/study?

```{r}
# What is your downain of research/study? 
# Responses are in columns 'Domain' through 'Column63'

n_responses_to_domain_question <-
  n_responses_to_the_question(postdata,
                              from_colname = Domain,
                              to_colname = Column63)

domain_perc <-
postdata %>%
  select(Domain:Column63) %>%
  gather(col, domain_perc) %>%
  group_by(domain_perc) %>%
  tally_and_perc(domain_perc,
                 na.rm = TRUE,
                 question_n = n_responses_to_domain_question) %>%
  filter(!is.na(domain_perc)) %>%
  arrange(desc(n)) %>%
  rename(Domain = domain_perc)

kable(domain_perc,
      format = "markdown",
      digits = getOption("digits"),
      row.names = NA,
      col.names = NA,
    caption = NULL,
    escape = TRUE)
```

__Feedback about the overall training event.__
Respondents were asked to rate their level of agreement about the following:

+ The amount of information covered was reasonable for alloted time.
+ The overall atmosphere was welcoming.
+ I learned skills that I will be able to use in my teaching.
+ The material preented matched the description of the training event.
+ I would recommend this training to a friend/colleague.
+ The training was worth my time.

```{r}
# Please give us some feedback about the overall training event.
# Subsetting a portion of the Likert items from InformationReasonableTime to Worth
myvars <- c("InformationReasonableTime", 
            "AtmosphereWelcoming", "LearnedSkills", "Material", "Recommend", "Worth") 
newdata <- postdata[myvars]            

cols_with_Agree <- map_lgl(newdata, ~`%in%`("Agree", .x))
newdata_agree <-  newdata[ , cols_with_Agree]

levels = c("Strongly Disagree",
   "Disagree",
   "Neither Agree nor Disagree",
   "Agree",
   "Strongly Agree")

 factorfunction <- function(newdata, factlevel){
  factor(newdata, 
         levels=factlevel, 
         ordered = TRUE)
    fct_unify(newdata, 
              levels=factlevel)}

newdata_agree_likert <- likert(data.frame(lapply(newdata_agree, factor, levels, ordered=TRUE)))
```

```{r training_perception_likert}
#Likert plot
title <- "Perception of Instructor Training Impact"
 theme_update(plot.title = element_text(hjust = 0.5))
plot(newdata_agree_likert) + ggtitle(title) 
```

```{r training_perception_heatmap}
#Heatmap
title <- "Perception of Instructor Training Impact"
plot(newdata_agree_likert, type =c("heat"), panel.arrange = NULL, panel.strip.color = "red", legend.position = "bottom") + ggtitle(title)
```

__How did you perceive the pace of the training?__
```{r training_pace}
# How did you perceive the pace of the training?
pace = c("Too slow", "Slightly slow", "Just right", "Slightly fast", "Too fast")
pace = factor(pace)

postdata$Pace = factor(postdata$Pace, levels = pace)

postdata_pace_tally <-
  postdata %>%
  group_by(Pace) %>%
  tally() %>%
  filter(!is.na(Pace)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_pace_tally)

ggplot(postdata_pace_tally,
       aes(Pace, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="orange") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Pace") +
  ylab("% Respondents") +
  ggtitle("Trainees Perception of Workshop Pace") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
```

__How was the balance of lecture to hands-on work?__

```{r training_balance_of_lecture}
# How was the balance of lecture to hands-on work?
handson = c("Too much lecture", 
            "Slightly too much lecture", 
            "Balanced (lecture/hands-on)", 
            "Slightly too much hands-on", 
            "Too much hands-on")
handson = factor(handson)

postdata$HandsOn = factor(postdata$HandsOn, levels = handson)

postdata_handson_tally <-
  postdata %>%
  group_by(HandsOn) %>%
  tally() %>%
  filter(!is.na(HandsOn)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_handson_tally)

ggplot(postdata_handson_tally,
       aes(HandsOn, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="orange") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Balance of Lecture") +
  ylab("% Respondents") +
  ggtitle("Trainees Perception of Workshop Balance: Lecture vs. Active") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
```

## About the Instructors and Helpers

__Please select how you felt the instructor trainers(s) performed.

+ Instructor trainer(s) gave clear answers to your questions.
+ Instructor trainer(s) were considerate.
+ Instructor trainer(s) were good communicators.
+ Instructor trainer(s) were enthusiastic.

```{r perception_trainers_performance}
# Please select how you felt the instructor trainers(s) performed.
# Code chunk for likert plot (perception of workshop instructors/helpers)
ordered_often <-
  c("Never", "Rarely", "Sometimes", "Often", "All of the time")

# Trainers
likert_cols_often_Train <- 
 postdata %>% 
   select(grep("Trainers", names(.))) %>% 
   mutate_if(is.character, as.factor) %>% 
   mutate_all(funs(fct_relevel(., ordered_often))) %>% 
   filter_all(all_vars(!is.na(.)))

names(likert_cols_often_Train) <- 
  gsub("Trainers", "", names(likert_cols_often_Train))
  
lc_often_train <- likert(data.frame(likert_cols_often_Train))

plot(lc_often_train) +
  ggtitle("Perception of How Instructor Trainers Performed")
```



__Feedback about workshop topics__

How much of the information presented at this training event was new to you?

```{r new_information}
# How much of the information presented at this training event was new to you?
newinfo = c("None of it", 
            "Some of it", 
            "About half of it", 
            "Most of it", 
            "Al of it")
newinfo = factor(newinfo)

postdata$NewInformation = factor(postdata$NewInformation, levels = newinfo)

postdata_newinfo_tally <-
  postdata %>%
  group_by(NewInformation) %>%
  tally() %>%
  filter(!is.na(NewInformation)) %>%
  mutate(perc = round(n/sum(n) * 100, 0))

kable(postdata_newinfo_tally)

ggplot(postdata_newinfo_tally,
       aes(NewInformation, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="orange") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("New Information") +
  ylab("% Respondents") +
  ggtitle("New Information Trainees were Presented") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
```

Trainees were asked to describe their experience with the following topics before the training, and their change in knowledge of these topics after the training. The topics are as follows:

+ Formative vs. summative assessment
+ Giving effective feedback
+ What makes someone a novice or expert
+ How human memory works
+ Cognitive load
+ What the Carpentries are and what they do
+ Motivation
+ Backwards design
+ Levels of cognition


```{r}
# Code chunk for Pre/Post plots for experience with topics covered
# The pre- and post- columns are different, so we can't put them on the same plot.
# Do two plots and then stack them up using grid.arrange(), nest(), and map() to combine the pre/post plots
  
experience_pre <-
    c("Little or no knowledge of topic",
    "Some knowledge of topic",
    "Extensive knowledge of topic")

experience_post <- 
  c("No increase in my knowledge", 
    "Knowledge increased slightly", 
    "Knowledge increased a great deal", 
    "N/A - Not covered at this workshop")

# Compute for all tools.

# Before the workshop
pre_experience <- 
postdata %>%
  select(contains("Pre")) %>% 
  gather() %>% 
  filter(value %in% experience_pre) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(postdata, ~tally_and_perc(.x, value))) %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("Pre", "", key))

# After the workshop
post_experience <- 
postdata %>%
  select(contains("Post")) %>% 
  gather() %>% 
  filter(value %in% experience_post) %>% 
  nest(-key) %>% 
  mutate(tallies = purrr::map(postdata, ~tally_and_perc(.x, value)))  %>% 
  unnest(tallies) %>% 
  mutate(key = gsub("Post", "", key))
```

```{r experience_with_topics_pre}
# Plot before and after as two grouped bar plots, then combine.

experience_pre_plot <- 
   ggplot(pre_experience, 
         aes(x = key,
             y = `%`,
             fill = fct_relevel(value, 
                             experience_pre))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4,
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Experience with Tools Pre-Workshop") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank())
```

```{r experience_with_topics_post}
experience_post_plot <- 
   ggplot(experience_post, 
         aes(x = key,
             y = `%`,
             fill = fct_rev(fct_relevel(value, 
                             (experience_pre))))) +
    geom_col(position = "dodge") +
    geom_text(aes(label=n), 
              size= 4,
              position=position_dodge(width=1)) +
    scale_x_discrete(labels = function(x) lapply(strwrap(x,
                                                         width = 10,
                                                         simplify = FALSE),
                                                 paste,
                                                 collapse = "\n")) +
    theme_classic() +
    xlab("") +
    ylab("% Respondents") +
    ggtitle("Change in Knowledge") +
    theme(plot.title = element_text(hjust = 0.5)) +
    theme_classic(base_size = 14) +
    theme(legend.position = "bottom", 
          legend.title=element_blank())
```

```{r pre_post_experience_comparison}
# put the two plots together
library(gridExtra)
grid.arrange(experience_post_plot, 
             experience_pre_plot,
             ncol = 1)
```