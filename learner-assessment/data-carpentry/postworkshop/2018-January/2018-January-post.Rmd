# DRAFT
# Data Carpentry's Post-Workshop Survey Report 
January 2018

```{r setup, include=FALSE}
library(knitr)
opts_chunk$set(echo = FALSE,
               message = FALSE,
               warning = FALSE)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(tidyr)
library(readr)
library(purrr)
library(tibble)
library(DBI)
library(ggmap)
library(likert)
library(mapproj)
library(RColorBrewer)
library(srvyr)
library(beeswarm)
library(NPS)
```
This report and the figures created were create using Data Carpentry's post-workshop surveys collected August 7, 2017 through January 8, 2018. A PDF of the survey questions, the data used in this analysis, and full R code are located on the Carpentries [assessment](https://github.com/carpentries/assessment/tree/master/data-carpentry/postworkshop/2018/January) repo on GitHub. Feel free to use the data and [tell us](mailto: kariljordan@carpentries.org) about your findings.

```{r echo=FALSE}
data <- readr::read_csv("https://raw.githubusercontent.com/carpentries/assessment/master/learner-assessment/data-carpentry/postworkshop/2018-January/data_180108.csv")
```


```{r}
# Function that makes a table of counts and percentages
tally_and_perc <- function(df, colname, na.rm = FALSE){
  quo_colname <- enquo(colname)

  df %>% 
    group_by(!!quo_colname) %>% 
    tally() %>% 
    filter(if_else(rep(na.rm, nrow(.)),
                  !is.na(!!quo_colname),
                  as.logical(rep(1, nrow(.))))) %>% 
    mutate(`%` = round(n / sum(n) * 100, 1)) 
}
```

### Workshop Location
The majority of respondents attended workshops in the United States, however, we see representation in multiple countries including Canada, Ethiopia, South Africa, and Switzerland.
```{r}
data %>% 
  tally_and_perc(`Country`, na.rm = TRUE) %>% 
  kable()
```

```{r include=FALSE}
#Data to include in-line
#Which workshop did you attend?
Workshop_Attended <- round(prop.table(table(data$Workshop))* 100)
Workshop_Attended

# In the report the in-line text says 53% although the table and plot show 64% for Ecology. Does this have to do with the function and not removing the NAs?
```
### Workshop Attended and Tools Covered 
Respondents were asked which workshop they attended: Ecology, Genomics, Geospatial, Reproducible Research, or Social Sciences. The majority of respondents (`r Workshop_Attended[1]`%) attended an Ecology workshop.

```{r}
# Q: Which workshop did you attend?
workshop = c("Ecology", "Genomics", "Geospatial", "Reproducible Research", "Social Sciences", "I don't know.")
workshop = factor(workshop)

data$Workshop = factor(data$Workshop, levels = workshop)

data_workshop_tally <- 
  data %>% 
  group_by(Workshop) %>% 
  tally() %>%
  filter(!is.na(Workshop)) 

ggplot(data_workshop_tally, 
       aes(`Workshop`, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="purple") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Workshop") +
  ylab("% Respondents") +
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
ggsave("figures/workshop_attended.png")

data %>% 
  tally_and_perc(`Workshop`, na.rm = TRUE) %>% 
  kable()
```

As the majority of workshop respondents attended an Ecology workshop, it is not surprise that R was covered in most workshops.

```{r}
# Q: Which of the following programming languages was covered in your workshop?
programminglanguage = c("R", "Python", "Neither", "I don't know./I don't remember.")
programminglanguage = factor(programminglanguage)

data$ToolCovered = factor(data$ToolCovered, levels = programminglanguage)

data_programminglanguage_tally <- 
  data %>% 
  group_by(ToolCovered) %>% 
  tally() %>%
  filter(!is.na(ToolCovered)) 

ggplot(data_programminglanguage_tally, 
       aes(`ToolCovered`, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="purple") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Programming Language Covered") +
  ylab("% Respondents") +
  ggtitle("") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
ggsave("figures/language_covered.png")

data %>% 
  tally_and_perc(`ToolCovered`, na.rm = TRUE) %>% 
  kable()
```

### Perception of Workshop Impact  
Learners were asked to rate their level of agreement with the following statements related to Data Carpentry's workshop goals and learning objectives:   
+ Having access to the original, raw data is important to be able to repeat an analysis.   
+ I can write a small program/script/macro to solve a problem in my own work.   
+ I know how to search for answers to my technical questions online.   
+ While working on a programming project, if I get stuck, I can find ways of overcoming the problem.  
+ I am confident in my ability to make use of programming software to work with data.  
+ Using a programming language (like R or Python) can make my analyses easier to reproduce.  
+ I can immediately apply what I learned at this workshop.  
+ I felt comfortable learning in this workshop environment.  
+ Using a programming language (like R or Python) can make me more efficient at working with data. 


```{r}
# Please rate your level of agreement with the following statements:
#Subsetting a portion of the Likert items from Organize-Data to Use-command-line
myvars <- c("RawData", "WriteProgram", "TechnicalQuestions", "OvercomeProblem", "ConfidenceSoftware", "ProgrammingEasier", "ImmediatelyApply", "ComfortableLearning", "ConfidentProgramming")
newdata <- data[myvars]

cols_with_Agree <- map_lgl(newdata, ~`%in%`("Agree", .x))
newdata_agree <-  newdata[ , cols_with_Agree]

levels = c("Strongly disagree",
   "Disagree",
   "Neutral",
   "Agree",
   "Strongly agree")

 factorfunction <- function(newdata, factlevel){
  factor(newdata, 
         levels=factlevel, 
         ordered = TRUE)
    fct_unify(newdata, 
              levels=factlevel)}

newdata_agree_likert <- likert(data.frame(lapply(newdata_agree, factor, levels, ordered=TRUE)))

#Likert plot
title <- "Perception of Workshop Impact"
 theme_update(plot.title = element_text(hjust = 0.5))
plot(newdata_agree_likert) + ggtitle(title) 
ggsave("figures/postworkshop_impact_likert.png")

#Heatmap
title <- "Perception of Workshop Impact"
plot(newdata_agree_likert, type =c("heat"), panel.arrange = NULL, panel.strip.color = "red", legend.position = "bottom") + ggtitle(title)
ggsave("figures/postworkshop_impact_heat.png")


## Neither of these plots are correct because we have respondents who selected STRONGLY AGREE
```

### Accessibility Issues 
Were there any accessibility issues that affected your ability to participate in this workshop? 
```{r}
# Accessibility Issues
# To do: Read the open ended responses for what issues came up.
data %>% 
  tally_and_perc(`AccessibilityIssues`, na.rm = TRUE) %>% 
  kable()
```

### Evaluation of Data Carpentry Instructors    
Please rate your level of agreement with the following statements:

+ I was able to get clear answers to my questions from the instructors.  
+ The instructors were enthusiastic about the workshop.  
+ I felt comfortable interacting with the instructors.  
+ The instructors were knowledgeable about the material being taught.

```{r}
# Please rate your level of agreement with the following statements:
#Subsetting a portion of the Likert items from Organize-Data to Use-command-line
myvars <- c("InstructorsClear", "InstructorsEnthusiastic", "InstructorsComfortable", "InstructorsKnowledgeable")
newdata <- data[myvars]

cols_with_Agree <- map_lgl(newdata, ~`%in%`("Agree", .x))
newdata_agree <-  newdata[ , cols_with_Agree]

levels = c("Strongly disagree",
   "Disagree",
   "Neutral",
   "Agree",
   "Strongly agree")

 factorfunction <- function(newdata, factlevel){
  factor(newdata, 
         levels=factlevel, 
         ordered = TRUE)
    fct_unify(newdata, 
              levels=factlevel)}

newdata_agree_likert <- likert(data.frame(lapply(newdata_agree, factor, levels, ordered=TRUE)))

#Likert plot
title <- "Perception of Data Carpentry Instructors"
 theme_update(plot.title = element_text(hjust = 0.5))
plot(newdata_agree_likert) + ggtitle(title) 
ggsave("figures/perception_instructors_likert.png")

#Heatmap
title <- "Perception of Data Carpentry Instructors"
plot(newdata_agree_likert, type =c("heat"), panel.arrange = NULL, panel.strip.color = "red", legend.position = "bottom") + ggtitle(title)
ggsave("figures/perception_instructors_heat.png")
```

### Recommending Data Carpentry Workshops
Learners were asked how likely they are to recommend this workshop to a friend or colleague using the [Net Promoter Score](https://en.wikipedia.org/wiki/Net_Promoter). The scoring for this question based on a 0 to 100 scale. Respondents scoring from 0 to 60 are labeled *Detractors*, and are believed to be less likely to recommend a workshop. Those who respond with a score of 90 to 100 are called *Promoters*, and are considered likely to recommend a workshop. Respondents between 70 and 80 are labeled *Passives*, and their behavior falls in the middle of Promoters and Detractors. 

```{r}
data$`Recommend` %>%
    npc(breaks = list(0:60, 70:80, 90:100)) %>%
    data.frame(category = .) %>%
    filter(!is.na(category)) %>%
    count(category) %>%
    mutate("%" = (n / sum(n))*100) %>%
    kable()
```

```{r}
data_recommend_tally <- 
  data %>% 
  group_by(Recommend) %>% 
  tally() %>%
  filter(!is.na(Recommend))

ggplot(data_recommend_tally, 
       aes(`Recommend`, y = 100 * (n/sum(n)),
           n)) +
  geom_bar(stat = "identity", fill="purple") +
  geom_text(aes(label=n), size= 4, vjust=-0.25) +
  scale_x_discrete(labels = function(x) lapply(strwrap(x, width = 10, simplify = FALSE), paste, collapse="\n")) +
  theme_classic() +
  xlab("Likely to Recommend") +
  ylab("% Respondents") +
  ggtitle("Likely to Recommend") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme_classic(base_size = 14)
ggsave("figures/likely_to_recommend.png")
```


